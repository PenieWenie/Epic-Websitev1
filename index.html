<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUSTANS EPIC WEBSITE</title>
    <link rel="icon" type="image/x-icon" href="images/icon.ico">
    <style>
        body {
            margin: 0;
            background: url('images/firebg.jpg') center/cover no-repeat fixed;
            font-family: 'Courier New', monospace;
            color: #ff00ff;
            overflow: hidden;
            position: relative;
            background-color: #1a1a1a;
        }

        @keyframes glitch {
            0% {
                transform: translate(0);
            }

            20% {
                transform: translate(-3px, 3px);
            }

            40% {
                transform: translate(3px, -3px);
            }

            60% {
                transform: translate(-2px, 2px);
            }

            80% {
                transform: translate(2px, -2px);
            }

            100% {
                transform: translate(0);
            }
        }

        .captcha {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .captcha-box {
            background: #000 url('https://www.transparenttextures.com/patterns/old-wall.png');
            border: 6px dotted #00ffff;
            padding: 20px;
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.7), inset 0 0 15px #ff00ff;
            width: 350px;
            text-align: center;
            animation: flicker 0.15s infinite alternate;
        }

        .captcha-text {
            font-size: 2em;
            text-shadow: 0 0 12px #00ffff;
            margin-bottom: 15px;
            color: #ff00ff;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .captcha-input {
            font-size: 1.5em;
            padding: 8px;
            width: 80%;
            background: #000;
            color: #00ffff;
            border: 4px dashed #ff00ff;
            text-align: center;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
        }

        .captcha-input:focus {
            outline: none;
            box-shadow: 0 0 20px #ff00ff;
        }

        .captcha-button {
            font-size: 1.8em;
            padding: 8px 16px;
            background: #00ffff;
            color: #ff00ff;
            border: 4px solid #ff00ff;
            cursor: pointer;
            text-shadow: 0 0 8px #ff00ff;
            transition: all 0.2s;
            font-family: 'Courier New', monospace;
        }

        .captcha-button:hover {
            background: #ff00ff;
            color: #00ffff;
            box-shadow: 0 0 25px #00ffff;
        }

        .captcha-timer {
            font-size: 1.3em;
            color: #00ffff;
            text-shadow: 0 0 10px #ff00ff;
            margin-top: 10px;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .keypad-button {
            font-size: 1.3em;
            padding: 12px;
            background: #000;
            color: #00ffff;
            border: 3px solid #ff00ff;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Courier New', monospace;
        }

        .keypad-button:hover {
            background: #ff00ff;
            color: #000;
        }

        .keypad-display {
            font-size: 1.5em;
            padding: 8px;
            width: 80%;
            background: #000;
            color: #00ffff;
            border: 4px dashed #ff00ff;
            text-align: center;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }

        .intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: url('images/explosion1.gif') center/cover no-repeat;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: explodeOut 7s forwards;
        }

        .intro-text {
            font-size: 8em;
            text-transform: uppercase;
            text-shadow: 0 0 40px #00ffff, 0 0 80px #ff00ff;
            animation: flicker 0.15s infinite alternate, introZoom 6s forwards;
            letter-spacing: 5px;
            color: #00ffff;
        }

        .content {
            position: relative;
            z-index: 10;
            padding: 30px;
            text-align: center;
            opacity: 0;
            animation: revealContent 1s forwards 7s;
            background: rgba(0, 0, 0, 0.7);
        }

        h1 {
            font-size: 5em;
            text-shadow: 0 0 25px #00ffff;
            animation: flicker 0.2s infinite alternate;
            margin: 30px 0;
            letter-spacing: 4px;
            color: #ff00ff;
            transition: transform 0.3s;
        }

        h1:hover {
            transform: rotate(-5deg);
            text-shadow: 0 0 50px #00ffff;
        }

        p,
        ul,
        ol {
            font-size: 2em;
            text-shadow: 0 0 20px #ff00ff;
            margin: 15px 0;
            letter-spacing: 2px;
            color: #00ffff;
            transition: transform 0.2s;
        }

        p:hover,
        li:hover {
            transform: translate(8px, -8px);
            text-shadow: 0 0 40px #ff00ff;
        }

        a {
            color: #ff00ff;
            text-decoration: underline wavy #00ffff;
            padding: 4px 8px;
            background: rgba(0, 255, 255, 0.2);
            transition: all 0.2s;
        }

        a:hover {
            animation: glitch 0.25s infinite;
            background: rgba(255, 0, 255, 0.4);
            color: #00ffff;
        }

        img {
            max-width: 350px;
            border: 8px dotted #ff00ff;
            transition: transform 0.2s;
            margin: 15px;
        }

        img:hover {
            transform: scale(1.2) rotate(8deg);
            box-shadow: 0 0 50px #00ffff;
        }

        .explosion {
            position: absolute;
            width: 300px;
            height: 300px;
            pointer-events: none;
            z-index: 100;
            background: url('images/explosion2.gif') center/contain no-repeat;
            animation: explodeFade 1s forwards;
        }



        .enemy {
            position: absolute;
            width: 100px;
            height: 100px;
            background: url('images/enemy.png') center/contain no-repeat;
            cursor: pointer;
            z-index: 50;
            transition: transform 0.1s;
        }

        #killDisplay {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 1.8em;
            color: #00ffff;
            text-shadow: 0 0 20px #ff00ff;
            z-index: 200;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 16px;
            border: 3px dotted #ff00ff;
            font-family: 'Courier New', monospace;
        }

        #virusDisplay {
            position: fixed;
            top: 60px;
            /* Adjust based on #killDisplay height, idc anymore lol*/
            right: 10px;
            font-size: 1.8em;
            color: #ff0000;
            text-shadow: 0 0 20px #00ff00;
            z-index: 200;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 16px;
            border: 3px dotted #ff0000;
            font-family: 'Courier New', monospace;
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5em;
            color: #ff00ff;
            text-shadow: 0 0 30px #00ffff;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 30px;
            border: 5px dotted #00ffff;
            z-index: 1000;
            animation: notifyPop 2s forwards;
            letter-spacing: 3px;
        }

        .turret {
            position: absolute;
            width: 50px;
            height: 50px;
            background: #ff00ff;
            border-radius: 50%;
            border: 3px solid #00ffff;
            cursor: move;
            z-index: 150;
        }

        .bullet {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #00ffff;
            border-radius: 50%;
            z-index: 75;
        }

        .ad {
            position: absolute;
            width: 200px;
            height: 150px;
            background: url('images/hotRussianAd.jpg') center/contain no-repeat;
            z-index: 60;
            pointer-events: none;
        }

        .pruner {
            position: absolute;
            width: 50px;
            height: 50px;
            background: #00ff00;
            border: 3px solid #ff0000;
            border-radius: 50%;
            cursor: move;
            z-index: 150;
        }

        @keyframes flicker {
            0% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes explodeOut {
            0% {
                opacity: 1;
            }

            85% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                display: none;
            }
        }

        @keyframes introZoom {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            20% {
                transform: scale(1);
                opacity: 1;
            }

            80% {
                transform: scale(1.1);
                opacity: 1;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        @keyframes explodeFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }

        @keyframes revealContent {
            0% {
                opacity: 0;
                transform: translateY(50px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes notifyPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }

            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
                display: none;
            }
        }

        .mute-button {
            font-size: 1.8em;
            padding: 10px 20px;
            background: #8800ff;
            color: #ff0000;
            border: 5px solid #0073ff;
            text-shadow: 3px 3px #0000ff, 0 0 10px #ffffff;
            cursor: pointer;
            margin: 20px;
            font-family: 'Comic Sans MS', cursive;
            transition: transform 0.3s;
        }

        .mute-button:hover {
            background: #ff0000;
            color: #00ff00;
            transform: scale(1.1);
            box-shadow: 0 0 20px #ffff00;
        }

        .construction-message {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 1.5em;
            color: #ffff00;
            text-shadow: 2px 2px #ff00ff, -2px -2px #00ffff, 0 0 10px #ffffff;
            font-family: 'Comic Sans MS', cursive;
            display: none;
            z-index: 2000;
        }

        #colorFilter {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 0, 255, 0.3), rgba(0, 255, 0, 0.3), rgba(0, 0, 255, 0.3));
            animation: colorShift 5s infinite;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            /* Start hidden with opacity */
            transition: opacity 1s ease-in;
            /* Fade in over 1 second */
        }

        #smokeOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('images/smoke.gif') center/cover no-repeat;
            opacity: 0.3;
            pointer-events: none;
            z-index: 150;
        }

        @keyframes colorShift {
            0% {
                filter: hue-rotate(0deg);
            }

            50% {
                filter: hue-rotate(180deg);
            }

            100% {
                filter: hue-rotate(360deg);
            }
        }

        #cat img {
            width: 100px;
            height: 100px;
            transition: animation-play-state 0.1s;
        }
    </style>
</head>

<body>
    <div id="captcha" class="captcha">
        <div class="captcha-box">
            <div id="captcha-text" class="captcha-text"></div>
            <input id="captcha-input" class="captcha-input" type="text" placeholder="TypE hErE" style="display: none;">
            <div id="keypad-display" class="keypad-display"></div>
            <div id="keypad" class="keypad" style="display: none;">
                <button class="keypad-button" onclick="keypadPress('1'); event.stopPropagation();">1</button>
                <button class="keypad-button" onclick="keypadPress('2'); event.stopPropagation();">2</button>
                <button class="keypad-button" onclick="keypadPress('3'); event.stopPropagation();">3</button>
                <button class="keypad-button" onclick="keypadPress('4'); event.stopPropagation();">4</button>
                <button class="keypad-button" onclick="keypadPress('5'); event.stopPropagation();">5</button>
                <button class="keypad-button" onclick="keypadPress('6'); event.stopPropagation();">6</button>
                <button class="keypad-button" onclick="keypadPress('7'); event.stopPropagation();">7</button>
                <button class="keypad-button" onclick="keypadPress('8'); event.stopPropagation();">8</button>
                <button class="keypad-button" onclick="keypadPress('9'); event.stopPropagation();">9</button>
                <button class="keypad-button" onclick="keypadPress('0'); event.stopPropagation();">0</button>
                <button class="keypad-button" onclick="keypadPress('clear'); event.stopPropagation();">CLEAR</button>
            </div>
            <button id="submit-button" class="captcha-button" onclick="checkCaptcha()">SUBMIT</button>
            <div id="captcha-timer" class="captcha-timer">30</div>
        </div>
    </div>
    <div class="intro" style="display: none;">
        <div class="intro-text">JUSTANS WEBSITE!</div>
    </div>
    <audio id="epicAudio" loop>
        <source src="audio/epicbattle.mp3" type="audio/mpeg">
    </audio>
    <audio id="bombSound">
        <source src="audio/bombSound.mp3" type="audio/mpeg">
    </audio>
    <div id="weedButton" style="position: fixed; bottom: 10px; right: 10px; z-index: 200; cursor: pointer;">
        <img src="images/weed.gif" alt="Smoke Weed" style="width: 50px; height: 50px;">
    </div>
    <div id="smokeOverlay" style="display: none;"></div>
    <div id="killDisplay">Enemies Killed: 0</div>
    <div id="virusDisplay">Viruses: 0</div>
    <div class="content">
        <!-- hitwebcounter Code START -->
        <a href="https://www.hitwebcounter.com" target="_blank">
            <img src="https://hitwebcounter.com/counter/counter.php?page=19407135&style=0034&nbdigits=5&type=page&initCount=0"
                title="Counter Widget" Alt="Visit counter For Websites" border="0" /></a>
        <div id="cat" style="position: fixed; top: 96px; left: 96px; z-index: 200; cursor: pointer;">
            <img src="images/spin.png" alt="Petable Cat" style="width: 100px; height: 100px;">
        </div>
        <h3>Total Vistors</h3>
        <h1>ABOUT ME</h1>
        <p>NAME: JUSTAN</p>
        <p>HELLO I AM JUSTAN SUN, I AM <strong>COOL</strong> AND <strong>EPIC</strong></p>
        <h1>COURSES</h1>
        <ul>
            <li>CPSC 1050</li>
            <li>CMNS 1150</li>
            <li>ENGL 1150</li>
        </ul>
        <h1>FAVORITES MOVIES</h1>
        <ol>
            <li><a href="https://www.imdb.com/title/tt0133093/">The Matrix</a> - EPIC MOVIE</li>
            <li><a href="https://www.imdb.com/title/tt1232829/">21 Jump Street</a> - BEST MOVIE EVER</li>
            <li><a href="https://www.netflix.com/title/80057281">Stranger Things</a> - GREAT TV SHOW</li>
        </ol>
        <h1>MOODS</h1>
        <p>Cool: <img src="images/sigma.jpg" alt="sigma"></p>
        <p>Confused: <img src="images/ohio.jpg" alt="Sad Blaster"></p>
        <h1>CPSC 1050</h1>
        <p>GOOD: COOL ASSIGNMENTS</p>
        <p>WORST: QUIZES HIT LIKE GORLOCK</p>
        <h1>Thank our sponsors</h1>
        <p>AD: <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ"><img src="images/hotRussianAd.jpg" alt="lol"></a>
        </p>
        <button class="mute-button" onclick="toggleMute()">MUTE SOUND</button>
    </div>
    <div class="construction-message" id="constructionMessage"></div>
    <script>
        //JAVASCRIPT logic, 
        //wip ai shooting and shrapnel upgrades
        //major bugs, bomb/captcha will break site completley if left open and unsolved for too long. prev timer is not being deleted. ETA, when i am interested
        //hover over and clicking noises needed for qol


        // Petable cat logic
        const cat = document.getElementById('cat');
        const catImg = cat.querySelector('img');
        const meowSound = new Audio('audio/meow.mp3');
        meowSound.preload = 'auto';
        meowSound.volume = 1.0; // Max volume

        cat.addEventListener('click', () => {
            // Switch to GIF and play meow
            catImg.src = 'images/spin.gif';
            meowSound.play().catch(err => console.log("Meow sound blocked:", err));

            // Revert to static image after 3 seconds
            setTimeout(() => {
                catImg.src = 'images/spin.png';
                meowSound.pause();
                meowSound.currentTime = 0;
            }, 3000);
        });

        // Weed button logic
        const weedButton = document.getElementById('weedButton');
        const colorFilter = document.createElement('div');
        colorFilter.id = 'colorFilter';
        document.body.appendChild(colorFilter);
        const smokeOverlay = document.getElementById('smokeOverlay');
        const inhaleSound = new Audio('audio/inhale.mp3');
        inhaleSound.preload = 'auto';
        inhaleSound.volume = 1.0;

        let isWeedActive = false;

        //BOOM and stuff, scree shake on click (removed), check if numpad is open, to avoid anooying flicker , exeption for weed button
        document.addEventListener('click', (e) => {
            if (!e.target.classList.contains('enemy') && !e.target.classList.contains('keypad-button') && e.target.id !== 'submit-button' && !e.target.classList.contains('turret') && e.target.id !== 'weedButton') {
                let explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = `${e.pageX - 150}px`;
                explosion.style.top = `${e.pageY - 150}px`;
                document.body.appendChild(explosion);
                setTimeout(() => explosion.remove(), 1000);

                let boomClone = boomSound.cloneNode();
                boomClone.volume = 0.8;
                boomClone.play().catch(err => console.log("Sound blocked:", err));
            }
        });

        weedButton.addEventListener('click', () => {
            if (!isWeedActive) {
                isWeedActive = true;
                colorFilter.style.opacity = '1'; // Fade in filter
                smokeOverlay.style.display = 'block'; // Fade in smoke to 70% opacity
                epicAudio.playbackRate = 0.7;
                inhaleSound.play().catch(err => console.log("Inhale sound blocked:", err));

                setTimeout(() => {
                    isWeedActive = false;
                    colorFilter.style.opacity = '0'; // Fade out filter
                    smokeOverlay.style.display = 'none'; // Fade out smoke
                    epicAudio.playbackRate = 1.0;
                }, 20000);
            }
        });

        //audio logic
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        //EPIC Background music
        let epicAudio = document.getElementById('epicAudio');
        epicAudio.muted = true;

        // CS:GO bomb sound
        let bombSound = document.getElementById('bombSound');

        // Explosion sound
        let boomSound = new Audio('audio/boom.mp3');
        boomSound.preload = 'auto';
        boomSound.onerror = function () {
            boomSound.src = 'https://www.myinstants.com/media/sounds/explosion.mp3';
        };

        // CAPTCHA arrays, prompts are by ai, so they are probaly half wrong
        let firstCaptcha = true;
        let captchaPrompts = [
            "Spell 'EXPLOSoiN' correctly.",
            "boom",
            "What’s the result of 9 - 4?",
            "Spell 'THUNDeR' quickly!",
            "Spell SIGMA backwards",
            "What’s the opposite of 'RUN'?",
            "Spell 'DETONATE' backwards.",
            "What’s the sum of 7 + 5?",
            "Write 'BOOM'",
            "Spell 'VIBRATE' correctly.",
            "WRITE 'ZAP'",
            "Spell 'CRASH' fast!",
            "What’s 12 divided by 3?",
            "Write 'K@b00m' with only letters",
            "Spell 'BOOMER' backwards.",
            "What’s the square root of 16?",
            "What’s the opposite of 'EXPLODE'?",
            "Spell 'PUWOLB' BACKWARDS",
            "What’s 3 multiplied by 6?"
        ];
        let captchaAnswers = [
            "EXPLOSION", "BOOM", "5", "THUNDER", "AMGIS", "STOP", "ETANOTED", "12", "BOOM", "VIBRATE",
            "ZAP", "CRASH", "4", "KABOOM", "REMOOB", "4", "DEFUSE", "BLOWUP", "18"
        ];

        //csgo bomb arrays, some are wrong, so get trolled, lololololololoolo
        let bombPrompts = [
            "Press four numbers in order, starting from 1.",
            "Press four numbers in order, starting from 5.",
            "Press the first four numbers, but backwards.",
            "Press only even numbers, increasing.",
            "Press four numbers counting down from 9.",
            "Press the first two numbers in order.",
            "Press two numbers after 4 in order.",
            "Press only odd numbers, increasing.",
            "Press only even numbers, decreasing.",
            "Press the sum of 2+1, then the first number.",
            "Press the highest single digit, then the lowest.",
            "Press four odd starting from 9 decending",
            "Press 1 3 1 2 4 2, dont press 3 or 4",
            "Press the double of 2, then double of 4.",
            "Press 7 n 5",
            "Press three one 4 one",
            "Press the first four digits of pi.",
            "Press three even numbers decending from 6.",
            "Press three numbers where eight, one and nine",
            "Press six numbers counting down from 9."
        ];

        let bombAnswers = [
            "1234", "5678", "4321", "2468", "9876", "12", "56", "1357", "8642", "31",
            "90", "9753", "1122", "48", "75", "2580", "3141", "624", "819", "987654"
        ];


        //get ques and anwser from arrays
        function generateCaptcha(isBomb) {
            if (isBomb) {
                let index = Math.floor(Math.random() * bombPrompts.length);
                document.getElementById('captcha-text').textContent = bombPrompts[index];
                return bombAnswers[index];
            } else {
                let index = Math.floor(Math.random() * captchaPrompts.length);
                document.getElementById('captcha-text').textContent = captchaPrompts[index];
                return captchaAnswers[index];
            }
        }

        let currentAnswer = "";
        let isBombCaptcha = false;
        let keypadInput = "";


        //broken mute lol
        function muteSound() {
            introSound.pause();
            const message = document.getElementById('constructionMessage');
            message.textContent = 'UNDER CONSTRUCTION';
            message.style.display = 'block';
        }

        //timer
        function startCaptchaTimer() {
            let timerElement = document.getElementById('captcha-timer');
            let timeLeft = isBombCaptcha ? 30 : 10;
            timerElement.textContent = timeLeft;
            bombSound.play();
            let timer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    bombSound.pause();
                    bombSound.currentTime = 0;
                    document.getElementById('captcha-text').textContent = 'TOO SLOW! Try again!';
                    document.getElementById('captcha-input').value = '';
                    document.getElementById('keypad-display').textContent = '';
                    keypadInput = "";
                    setTimeout(() => {
                        setupCaptcha();
                    }, 1000);
                }
            }, 1000);
            return timer;
        }

        function keypadPress(value) {
            if (value === 'clear') {
                keypadInput = "";
            } else {
                keypadInput += value;
            }
            document.getElementById('keypad-display').textContent = keypadInput;
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const frequencies = {
                '0': 261.63, '1': 293.66, '2': 329.63, '3': 349.23, '4': 392.00,
                '5': 440.00, '6': 493.88, '7': 523.25, '8': 587.33, '9': 659.25,
                'clear': 784.00
            };
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(frequencies[value], audioCtx.currentTime);
            oscillator.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }


        //bomb captcha
        function setupCaptcha() {
            isBombCaptcha = Math.random() < 0.5;
            currentAnswer = generateCaptcha(isBombCaptcha);
            if (isBombCaptcha) {
                document.getElementById('captcha-input').style.display = 'none';
                document.getElementById('keypad').style.display = 'grid';
                document.getElementById('keypad-display').style.display = 'block';
                document.getElementById('keypad-display').textContent = '';
                keypadInput = "";
            } else {
                document.getElementById('captcha-input').style.display = 'block';
                document.getElementById('keypad').style.display = 'none';
                document.getElementById('keypad-display').style.display = 'none';
                document.getElementById('captcha-input').value = '';
            }
            captchaTimer = startCaptchaTimer();
        }

        let captchaTimer = null;
        setupCaptcha(); // Initial CAPTCHA, ensure that intro does not play for others **IMPORTANT**

        function checkCaptcha() {
            console.log("Submit button clicked"); //button click debuglkjfls sflkjdsjfldsj
            let input = isBombCaptcha ? keypadInput : document.getElementById('captcha-input').value.toUpperCase();
            if (input === currentAnswer) {
                console.log("Correct answer entered"); //corect awnser deug
                clearInterval(captchaTimer);
                bombSound.pause();
                bombSound.currentTime = 0;
                document.getElementById('captcha').style.display = 'none';

                //(C major: C4, E4, G4)
                const happyFrequencies = [261.63, 329.63, 392.00]; // C4, E4, G4
                happyFrequencies.forEach(freq => {
                    const oscillator = audioCtx.createOscillator();
                    oscillator.type = 'triangle'; //happy sound
                    oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
                    oscillator.connect(audioCtx.destination);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.5); // 0.5-second chord
                });

                if (firstCaptcha) {
                    document.querySelector('.intro').style.display = 'flex';
                    epicAudio.play();
                    epicAudio.muted = false;
                    startGame();
                    firstCaptcha = false;
                } else {
                    document.body.style.overflow = 'auto';
                }
            } else {
                console.log("Wrong answer: " + input); //wrong awnser debug bomb
                document.getElementById('captcha-text').textContent = 'WRONG! Try again!';

                //(A minor: A3, C4, E4)
                const sadFrequencies = [220.00, 261.63, 329.63]; // A3, C4, E4
                sadFrequencies.forEach(freq => {
                    const oscillator = audioCtx.createOscillator();
                    oscillator.type = 'triangle'; //FAILED SOUND
                    oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
                    oscillator.connect(audioCtx.destination);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.5);
                });

                if (isBombCaptcha) {
                    document.getElementById('keypad-display').textContent = '';
                    keypadInput = "";
                } else {
                    document.getElementById('captcha-input').value = '';
                }
                clearInterval(captchaTimer);
                bombSound.pause();
                bombSound.currentTime = 0;
                setTimeout(() => {
                    setupCaptcha();
                }, 1000);
            }
        }


        // New kill counter with killvar
        const initialWidth = window.innerWidth;
        const initialHeight = window.innerHeight; //original window limits before scrolling
        let killvar = 0;
        let enemySpawnNum = 0;
        let killDisplay = document.getElementById('killDisplay');
        let virusDisplay = document.getElementById('virusDisplay');
        killDisplay.textContent = `Enemies Killed: ${killvar}`; // Initial display
        virusDisplay.textContent = `Viruses: ${enemySpawnNum}`;
        let turretCount = 0; // Track number of turrets
        let enemySpawnInt = 6000; //enemy spawn interval
        let enemySpawnIntervalId = null; // Added to track and update spawn interval





        // Image explosions 
        document.querySelectorAll('img').forEach(img => {
            img.addEventListener('click', (e) => {
                let explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = `${e.pageX - 150}px`;
                explosion.style.top = `${e.pageY - 150}px`;
                document.body.appendChild(explosion);
                setTimeout(() => explosion.remove(), 1000);

                let boomClone = boomSound.cloneNode();
                boomClone.volume = 0.8;
                boomClone.play().catch(err => console.log("Sound blocked:", err)); //sound debug
            });
        });

        // Turret spawning and dragging
        function spawnTurret() {
            let turret = document.createElement('div');
            turret.className = 'turret';
            turret.style.left = `25px`; //left edge
            turret.style.top = `25px`; //top ege
            document.body.appendChild(turret);
            turretCount++;
            console.log("Turret spawned at top-left, total: " + turretCount); //spawn debug

            // Make turret draggable
            let isDragging = false;
            let currentX, currentY, initialX, initialY;

            turret.addEventListener('mousedown', (e) => {
                isDragging = true;
                initialX = e.clientX - currentX;
                initialY = e.clientY - currentY;
                turret.style.cursor = 'grabbing';
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    turret.style.left = `${currentX}px`;
                    turret.style.top = `${currentY}px`;
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                turret.style.cursor = 'move';
            });

            currentX = parseFloat(turret.style.left);
            currentY = parseFloat(turret.style.top);

            // Turret shooting at enemies
            setInterval(() => {
                shootBullet(turret);
            }, 1000); // 1 sec
        }

        // Bullet shooting logic targeting enemies
        function shootBullet(turret) {
            let enemies = document.querySelectorAll('.enemy');
            if (enemies.length === 0) return; // No enemies

            let targetEnemy = enemies[Math.floor(Math.random() * enemies.length)]; // Randomly pick an enemy
            let bullet = document.createElement('div');
            bullet.className = 'bullet';
            let turretX = parseFloat(turret.style.left) + 20; // Center of turret
            let turretY = parseFloat(turret.style.top) + 20;
            bullet.style.left = `${turretX}px`;
            bullet.style.top = `${turretY}px`;
            document.body.appendChild(bullet);

            //Calculate direction towards target enemy,whith trig
            let enemyX = parseFloat(targetEnemy.style.left) + 50; // Center of enemy
            let enemyY = parseFloat(targetEnemy.style.top) + 50;
            let dx = enemyX - turretX;//more trig
            let dy = enemyY - turretY;
            let distance = Math.sqrt(dx * dx + dy * dy);//trig lololololooloo
            let speed = 5;
            let velocityX = (dx / distance) * speed;
            let velocityY = (dy / distance) * speed;

            function moveBullet() {
                let bulletX = parseFloat(bullet.style.left) + velocityX;
                let bulletY = parseFloat(bullet.style.top) + velocityY;

                // Remove bullet if its alive for more than 5 sec
                setTimeout(() => {
                    bullet.remove();
                }, 5000);//5 sec

                bullet.style.left = `${bulletX}px`;
                bullet.style.top = `${bulletY}px`;

                //Check collision with enemies
                document.querySelectorAll('.enemy').forEach(enemy => {
                    let enemyRect = enemy.getBoundingClientRect();
                    let bulletRect = bullet.getBoundingClientRect();
                    if (bulletRect.left < enemyRect.right &&
                        bulletRect.right > enemyRect.left &&
                        bulletRect.top < enemyRect.bottom &&
                        bulletRect.bottom > enemyRect.top) {
                        let explosion = document.createElement('div');
                        explosion.className = 'explosion';
                        explosion.style.left = `${enemyRect.left - 150 + window.scrollX}px`;
                        explosion.style.top = `${enemyRect.top - 150 + window.scrollY}px`;
                        document.body.appendChild(explosion);
                        setTimeout(() => explosion.remove(), 1000);

                        let boomClone = boomSound.cloneNode();
                        boomClone.volume = 0.8;
                        boomClone.play().catch(err => console.log("Sound blocked:", err));

                        enemy.remove();
                        bullet.remove();
                        killvar += 1;
                        enemySpawnNum--;
                        killDisplay.textContent = `Enemies Killed: ${killvar}`;
                        checkLevelUp();
                    }
                });

                if (bullet.parentNode) requestAnimationFrame(moveBullet);
            }
            requestAnimationFrame(moveBullet);
        }

        // Enemy invasion with movement, huh why i write this
        // Spawn the pruner in the top-right corner
        function spawnPruner() {
            let pruner = document.createElement('div');
            pruner.className = 'pruner';
            pruner.style.left = `${window.innerWidth - 75}px`;
            pruner.style.top = `25px`;
            document.body.appendChild(pruner);

            //Draggable logic, look up draging html if broken
            let isDragging = false;
            let currentX = parseFloat(pruner.style.left);
            let currentY = parseFloat(pruner.style.top);
            let initialX, initialY;

            pruner.addEventListener('mousedown', (e) => {
                isDragging = true;
                initialX = e.clientX - currentX;
                initialY = e.clientY - currentY;
                pruner.style.cursor = 'grabbing';
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    pruner.style.left = `${currentX}px`;
                    pruner.style.top = `${currentY}px`;
                    checkPrunerCollision(pruner); // Check for ad removal
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                pruner.style.cursor = 'move';
            });
        }

        //pawn ads randomly
        function spawnAd() {
            let ad = document.createElement('div');
            ad.className = 'ad';
            let adX, adY;
            do {
                adX = Math.random() * (document.body.scrollWidth - 200); //ad width
                adY = Math.random() * (document.body.scrollHeight - 150); //ad height
            } while (
                adX >= 0 && adX <= initialWidth &&
                adY >= 0 && adY <= initialHeight
            ); //dont spawn uptop
            ad.style.left = `${adX}px`;
            ad.style.top = `${adY}px`;
            document.body.appendChild(ad);

            /*  //Remove ad after some time if not pruned, nah we punish user
            setTimeout(() => {
                if (ad.parentNode) ad.remove();
            }, 20000); // Despawn after 20 seconds */
        }

        //Check if pruner collides with an ad
        function checkPrunerCollision(pruner) {
            let prunerRect = pruner.getBoundingClientRect();
            document.querySelectorAll('.ad').forEach(ad => {
                let adRect = ad.getBoundingClientRect();
                if (
                    prunerRect.left < adRect.right &&
                    prunerRect.right > adRect.left &&
                    prunerRect.top < adRect.bottom &&
                    prunerRect.bottom > adRect.top
                ) {
                    //Collision detected = remove ad with explosion effect
                    let explosion = document.createElement('div');
                    explosion.className = 'explosion';
                    explosion.style.left = `${adRect.left - 150 + window.scrollX}px`;
                    explosion.style.top = `${adRect.top - 150 + window.scrollY}px`;
                    document.body.appendChild(explosion);
                    setTimeout(() => explosion.remove(), 1000);

                    let boomClone = boomSound.cloneNode();
                    boomClone.volume = 0.8;
                    boomClone.play().catch(err => console.log("Sound blocked:", err));

                    ad.remove();
                }
            });
        }

        //Start the pruner an ad spawning, temp disabled
        function startAdFeature() {
            spawnPruner(); //spawn prunerr
            // setInterval(spawnAd, 10000); //10 sec (disabled)
        }

        //start game after intro
        function startGame() {
            console.log("Game starting");
            setTimeout(() => {
                document.querySelector('.intro').style.display = 'none';
                document.body.style.overflow = 'auto';
                enemySpawnIntervalId = setInterval(spawnEnemy, enemySpawnInt); // Changed to use tracked ID
                spawnTurret(); //Spawn initial turret, removeee???????????
                //startAdFeature(); //guogle ads (disabled)
            }, 7000);
            setInterval(() => {
                console.log("Periodic CAPTCHA triggered");
                document.getElementById('captcha').style.display = 'flex';
                setupCaptcha();
            }, 60000);
        }

        //spawn enemies
        function spawnEnemy() {
            let enemy = document.createElement('div');
            enemySpawnNum++;
            enemy.className = 'enemy';
            let startX, startY;
            do {
                startX = Math.random() * (window.innerWidth - 100);
                startY = Math.random() * (document.body.scrollHeight - 100);
            } while (
                startX >= 0 && startX <= initialWidth &&
                startY >= 0 && startY <= initialHeight
            ); //Ensure spawn is outside initial window
            enemy.style.left = `${startX}px`;
            enemy.style.top = `${startY}px`;
            document.body.appendChild(enemy);

            //Random movement
            let speedX = (Math.random() - 0.5) * 4;
            let speedY = (Math.random() - 0.5) * 4;
            function moveEnemy() {
                let x = parseFloat(enemy.style.left) + speedX;
                let y = parseFloat(enemy.style.top) + speedY;

                if (x < 0 || x > window.innerWidth - 100) speedX = -speedX;
                if (y < 0 || y > document.body.scrollHeight - 100) speedY = -speedY;

                enemy.style.left = `${x}px`;
                enemy.style.top = `${y}px`;
                if (enemy.parentNode) requestAnimationFrame(moveEnemy);
            }
            requestAnimationFrame(moveEnemy);

            // Kill enemy on click
            enemy.addEventListener('click', (e) => {
                let explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = `${e.pageX - 150}px`;
                explosion.style.top = `${e.pageY - 150}px`;
                document.body.appendChild(explosion);
                setTimeout(() => explosion.remove(), 1000);

                let boomClone = boomSound.cloneNode();
                boomClone.volume = 0.8;
                boomClone.play().catch(err => console.log("Sound blocked:", err));

                enemy.remove();
                killvar += 1;
                killDisplay.textContent = `Enemies Killed: ${killvar}`;
                enemySpawnNum--; //Update net enemy count
                virusDisplay.textContent = `Viruses: ${enemySpawnNum}`; //Update prompt
                checkLevelUp();
            });

            //Update enemySpawnNum and virusDisplay on spawn
            virusDisplay.textContent = `Viruses: ${enemySpawnNum}`;
            checkServerCrash();
        }

        //more than 20 virus kill window
        function checkServerCrash() {
            if (enemySpawnNum > 20) {
                //Show popup and attempt to close window
                alert("SERVER CRASHED! Too many viruses detected (" + enemySpawnNum + "). Closing server...");
                window.close(); //Try to close the window

                //epic fail
                document.body.innerHTML = "<h1 style='color: #ff0000; text-align: center; font-family: Courier New;'>SERVER CRASHED! Please close this tab manually.</h1>";
            }
        }

        // Check for level up and spawn new turret
        function checkLevelUp() {
            let milestones = [15, 30, 45, 60, 75, 90, 100];
            if (milestones.includes(killvar)) {
                let notification = document.createElement('div');
                //enemySpawnInt = enemySpawnInt/3; // Removed this line as replaced 
                notification.className = 'notification';
                notification.textContent = `KILL STREAK: ${killvar} - NEW TURRET UNLOCKED! ENEMIES DOUBLED!`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 6000); //delete after 6 secs

                // Double enemy spawn rate by halving the delay
                enemySpawnInt = Math.max(enemySpawnInt / 1.5, 100); // Minimum 100ms
                clearInterval(enemySpawnIntervalId); //Clear the old spawn interval
                enemySpawnIntervalId = setInterval(spawnEnemy, enemySpawnInt); // Set ne ster interval
                console.log("Enemy spawn interval updated to: " + enemySpawnInt + "ms"); // Debug spawn rate

                //turrent fix, kinda goofy ngl
                let expectedTurrets = 1 + Math.floor(killvar / 15);
                let currentTurrets = document.querySelectorAll('.turret').length;
                if (currentTurrets < expectedTurrets) {
                    spawnTurret();
                }
            }
            if (killvar === 100) {
                let notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = `MISSION COMPLETE SOLDIER`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 200000);
            }
        }


    </script>
</body>

</html>